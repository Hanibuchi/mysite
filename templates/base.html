{% load static %}
<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="{% static 'favicon.ico' %}" rel="icon" />
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,container-queries"></script>
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>Hanitech Blog</title>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "primary": {
                            DEFAULT: "#007BFF",
                            '50': '#E6F2FF',
                            '100': '#CCE5FF',
                            '200': '#99CBFF',
                            '300': '#66B2FF',
                            '400': '#3398FF',
                            '500': '#007BFF',
                            '600': '#0062CC',
                            '700': '#004A99',
                            '800': '#003166',
                            '900': '#001933',
                        },
                        "background": "#F8F9FA",
                        "surface": "#FFFFFF",
                        "text-primary": "#212529",
                        "text-secondary": "#6C757D",
                        "text-light": "#64748b",
                        "text-main": "#1e293b",
                        "background-light": "#f8fafc", // Very light gray, almost white
                        "background-dark": "#1e293b", // A dark slate for dark mode
                        "text-light-primary": "#111827", // Dark gray for main text on light bg
                        "text-light-secondary": "#4b5563", // Lighter gray for secondary text
                        "text-dark-primary": "#f8fafc",
                        "text-dark-secondary": "#9ca3af",
                        "border-light": "#e5e7eb",
                        "border-dark": "#334155",
                    },
                    fontFamily: {
                        sans: ["Inter", "sans-serif"],
                    },
                    boxShadow: {
                        'card': '0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05)',
                        'card-hover': '0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07)',
                    },
                    borderRadius: {
                        DEFAULT: "0.5rem",
                        lg: "0.5rem",
                        xl: "1rem",
                        full: "9999px"
                    },
                },
            },
        }
    </script>

    {% block head_extra %}
    {% endblock head_extra %}
</head>

<body class="bg-background-light text-text-main font-sans antialiased">
    <div class="flex flex-col min-h-screen">
        {% block header %}
        <header class="sticky top-0 z-50 bg-background-light/80 backdrop-blur-md border-b border-border-light">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex h-20 items-center justify-between">
                    <a class="flex items-center gap-2" href="{% url 'main' %}">
                        <span class="text-2xl font-semibold text-text-primary">ハニテックのブログ</span>
                    </a>

                    <nav class="hidden md:flex items-center gap-4">
                        <a class="text-base font-medium {% if active_page == 'main' %} text-text-primary bg-gray-200 {% else %} text-text-secondary hover:text-text-primary {% endif %} transition-colors px-4 py-2 rounded-lg"
                            href="{% url 'main' %}">Home</a>
                        <a class="text-base font-medium {% if active_page == 'portfolio-list' %} text-text-primary bg-gray-200 {% else %} text-text-secondary hover:text-text-primary {% endif %} px-4 py-2 rounded-lg"
                            href="{% url 'portfolio_list' %}">Works</a>
                        <a class="text-base font-medium {% if active_page == 'blog-list' %} text-text-primary bg-gray-200 {% else %} text-text-secondary hover:text-text-primary {% endif %} transition-colors px-4 py-2 rounded-lg"
                            href="{% url 'blog_list' %}">Blog</a>

                        {% if user.is_authenticated %}
                        <div class="relative">
                            <button id="user-menu-button" class="flex items-center gap-2">
                                <span class="material-symbols-outlined text-text-secondary">person</span>
                                <span class="font-medium text-text-primary">{{ user.username }}</span>
                                <span id="dropdown-arrow"
                                    class="material-symbols-outlined text-text-secondary transition-transform">expand_more</span>
                            </button>
                            <div id="user-menu"
                                class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg py-1 hidden">
                                <a class="block px-4 py-2 text-sm text-text-secondary hover:bg-gray-100"
                                    href="{% url 'password_change' %}">パスワード変更</a>
                                <form method="post" action="{% url 'logout' %}">
                                    {% csrf_token %}
                                    <button type="submit"
                                        class="block w-full text-left px-4 py-2 text-sm text-text-secondary hover:bg-gray-100 focus:outline-none">
                                        ログアウト
                                    </button>
                                </form>
                            </div>
                        </div>
                        {% else %}
                        <a class="text-base font-medium text-text-secondary hover:text-text-primary transition-colors px-4 py-2 rounded-lg"
                            href="{% url 'login' %}">Login</a>
                        {% endif %}

                    </nav>

                    <button id="menu-toggle-button" aria-label="Open navigation menu"
                        class="md:hidden inline-flex items-center justify-center rounded-lg p-2 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-accent">
                        <span class="material-symbols-outlined text-3xl text-text-primary">menu</span>
                    </button>
                </div>
            </div>

            <nav id="mobile-menu" class="hidden md:hidden bg-surface border-t border-border-light p-4 space-y-2">
                <a class="block text-base font-medium {% if active_page == 'main' %} text-text-primary bg-gray-200 {% else %} text-text-secondary hover:text-text-primary {% endif %} transition-colors px-4 py-2 rounded-lg"
                    href="{% url 'main' %}">Home</a>
                <a class="block text-base font-medium {% if active_page == 'portfolio-list' %} text-text-primary bg-gray-200 {% else %} text-text-secondary hover:text-text-primary {% endif %} px-4 py-2 rounded-lg"
                    href="{% url 'portfolio_list' %}">Works</a>
                <a class="block text-base font-medium {% if active_page == 'blog-list' %} text-text-primary bg-gray-200 {% else %} text-text-secondary hover:text-text-primary {% endif %} transition-colors px-4 py-2 rounded-lg"
                    href="{% url 'blog_list' %}">Blog</a>

                {% if user.is_authenticated %}
                <a class="block text-base font-medium text-text-secondary hover:text-text-primary transition-colors px-4 py-2 rounded-lg"
                    href="{% url 'password_change' %}">パスワード変更</a>
                <form method="post" action="{% url 'logout' %}">
                    {% csrf_token %}
                    <button type="submit"
                        class="block w-full text-left text-base font-medium text-text-secondary hover:text-text-primary transition-colors px-4 py-2 rounded-lg">
                        ログアウト
                    </button>
                </form>
                {% else %}
                <a class="block text-base font-medium text-text-secondary hover:text-text-primary transition-colors px-4 py-2 rounded-lg"
                    href="{% url 'login' %}">Login</a>
                {% endif %}
            </nav>
        </header>
        {% endblock header %}

        {% block content %}
        {% endblock content %}

        {% block footer %}
        <footer class="bg-background-light border-t border-border-light">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <p class="text-center text-sm text-text-secondary">© 2025 ハニテック. All rights reserved.</p>
            </div>
        </footer>
        {% endblock footer %}
    </div>
    <script>
        // HTMLが完全に読み込まれた後に、この中の処理を実行する
        document.addEventListener('DOMContentLoaded', () => {

            // --- ドロップダウンメニュー用要素の取得 ---
            const menuButton = document.getElementById('user-menu-button');
            const userMenu = document.getElementById('user-menu');
            const dropdownArrow = document.getElementById('dropdown-arrow');

            // --- ハンバーガーメニュー用要素の取得 ---
            const menuToggleButton = document.getElementById('menu-toggle-button');
            const mobileMenu = document.getElementById('mobile-menu');


            // --- 2. ボタンにクリックされたときの動作を設定する ---

            // 💡 ユーザーメニュー（ドロップダウン）の処理 (既存)
            if (menuButton && userMenu && dropdownArrow) {
                menuButton.addEventListener('click', () => {
                    userMenu.classList.toggle('hidden');
                    dropdownArrow.classList.toggle('rotate-180');
                });
            }

            // 💡 ハンバーガーメニューの処理 (新規)
            if (menuToggleButton && mobileMenu) {
                menuToggleButton.addEventListener('click', () => {
                    // hiddenクラスをトグル（切り替え）して、メニューの表示/非表示を切り替える
                    mobileMenu.classList.toggle('hidden');

                    // 必要であれば、ハンバーガーアイコンを×印などに変える処理もここに追加できます
                });
            }


            // --- 💡 (おまけ) メニュー外をクリックしたら閉じる処理 ---

            // ページ全体でのクリックを監視
            document.addEventListener('click', (event) => {

                // --- ユーザーメニュー（ドロップダウン）の処理 (既存) ---
                if (menuButton && userMenu && dropdownArrow) {
                    const isClickedOutsideUserMenu = !menuButton.contains(event.target) && !userMenu.contains(event.target);
                    const isUserMenuOpen = !userMenu.classList.contains('hidden');

                    if (isClickedOutsideUserMenu && isUserMenuOpen) {
                        userMenu.classList.add('hidden');
                        dropdownArrow.classList.remove('rotate-180');
                    }
                }

                // --- ハンバーガーメニューの処理 (新規) ---
                if (menuToggleButton && mobileMenu) {
                    const isClickedOutsideMobileMenu = !menuToggleButton.contains(event.target) && !mobileMenu.contains(event.target);
                    const isMobileMenuOpen = !mobileMenu.classList.contains('hidden');

                    if (isClickedOutsideMobileMenu && isMobileMenuOpen) {
                        // メニューを閉じる（hiddenクラスを追加）
                        mobileMenu.classList.add('hidden');
                        // 必要であれば、アイコンを元に戻す処理もここに追加できます
                    }
                }

            });

        });
    </script>

    {% block extra_js %}
    {% endblock extra_js %}
</body>

</html>