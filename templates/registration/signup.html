{% extends 'base.html' %}

{% block head_extra %}
{% endblock head_extra %}

{% block content %}
<main class="flex flex-col items-center p-10">
  <div class="w-full max-w-lg">
    <div class="flex flex-wrap justify-between gap-3 p-4 mb-8">
      <p
        class="text-[#111418] text-4xl font-black leading-tight tracking-[-0.033em] w-full text-center newsreader-font">
        アカウント新規作成</p>
    </div>

    <form method="post">
      {% csrf_token %}

      {% if form.non_field_errors %}
      <div class="mb-6 px-4 text-sm text-red-600">
        {% for error in form.non_field_errors %}
        <p>{{ error }}</p>
        {% endfor %}
      </div>
      {% endif %}

      <div class="flex flex-col gap-6 px-4">
        <label class="flex flex-col w-full">
          <p class="text-[#111418] text-base font-medium leading-normal pb-2" for="{{ form.username.id_for_label }}">
            ユーザー名</p>
          <input
            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] focus:outline-0 focus:ring-0 border border-[#dbe0e6] bg-white focus:border-[#dbe0e6] h-14 placeholder:text-[#617589] p-[15px] text-base font-normal leading-normal"
            id="{{ form.username.id_for_label }}" name="{{ form.username.name }}" type="text"
            placeholder="ユーザー名を入力してください" value="{{ form.username.value|default_if_none:'' }}" required />
          {% if form.username.errors %}
          {% for error in form.username.errors %}
          <p class="mt-2 text-sm text-red-600">{{ error }}</p>
          {% endfor %}
          {% endif %}
        </label>

        <label class="flex flex-col w-full">
          <p class="text-[#111418] text-base font-medium leading-normal pb-2" for="{{ form.email.id_for_label }}">
            メールアドレス（オプション）</p>
          <input
            class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] focus:outline-0 focus:ring-0 border border-[#dbe0e6] bg-white focus:border-[#dbe0e6] h-14 placeholder:text-[#617589] p-[15px] text-base font-normal leading-normal"
            id="{{ form.email.id_for_label }}" name="{{ form.email.name }}" type="email" placeholder="メールアドレスを入力してください"
            value="{{ form.email.value|default_if_none:'' }}" required />
          {% if form.email.errors %}
          {% for error in form.email.errors %}
          <p class="mt-2 text-sm text-red-600">{{ error }}</p>
          {% endfor %}
          {% endif %}
        </label>

        <label class="flex flex-col w-full">
          <p class="text-[#111418] text-base font-medium leading-normal pb-2" for="{{ form.password1.id_for_label }}">
            パスワード</p>
          <div class="flex w-full flex-1 items-stretch rounded-lg">
            <input
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] focus:outline-0 focus:ring-0 border border-[#dbe0e6] bg-white focus:border-[#dbe0e6] h-14 placeholder:text-[#617589] p-[15px] rounded-r-none border-r-0 pr-2 text-base font-normal leading-normal"
              id="{{ form.password1.id_for_label }}" name="{{ form.password1.name }}" placeholder="パスワードを入力してください"
              type="password" required />
            <div
              class="text-[#617589] flex border border-[#dbe0e6] bg-white items-center justify-center pr-[15px] rounded-r-lg border-l-0 cursor-pointer"
              id="toggle-password-1" aria-label="Toggle password visibility">
              <span class="material-symbols-outlined" style="font-size: 24px;">visibility_off</span>
            </div>
          </div>
          {% if form.password1.errors %}
          {% for error in form.password1.errors %}
          <p class="mt-2 text-sm text-red-600">{{ error }}</p>
          {% endfor %}
          {% endif %}
        </label>

        <label class="flex flex-col w-full">
          <p class="text-[#111418] text-base font-medium leading-normal pb-2" for="{{ form.password2.id_for_label }}">
            パスワード（確認用）</p>
          <div class="flex w-full flex-1 items-stretch rounded-lg">
            <input
              class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#111418] focus:outline-0 focus:ring-0 border border-[#dbe0e6] bg-white focus:border-[#dbe0e6] h-14 placeholder:text-[#617589] p-[15px] rounded-r-none border-r-0 pr-2 text-base font-normal leading-normal"
              id="{{ form.password2.id_for_label }}" name="{{ form.password2.name }}" placeholder="パスワードを再度入力してください"
              type="password" required />
            <div
              class="text-[#617589] flex border border-[#dbe0e6] bg-white items-center justify-center pr-[15px] rounded-r-lg border-l-0 cursor-pointer"
              id="toggle-password-2" aria-label="Toggle password visibility">
              <span class="material-symbols-outlined" style="font-size: 24px;">visibility_off</span>
            </div>
          </div>
          {% if form.password2.errors %}
          {% for error in form.password2.errors %}
          <p class="mt-2 text-sm text-red-600">{{ error }}</p>
          {% endfor %}
          {% endif %}
        </label>

        <button
          class="flex items-center justify-center whitespace-nowrap h-14 px-8 rounded-lg w-full bg-[#111418] text-white text-base font-medium leading-normal mt-6"
          type="submit">アカウント作成</button>

        <p class="text-center text-sm text-[#617589]">すでにアカウントをお持ちですか？ <a class="text-[#111418] font-medium underline"
            href="{% url 'login' %}">ログイン</a></p>
      </div>
    </form>
  </div>
</main>
{% endblock content %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    function setupPasswordToggle(inputElementId, toggleButtonId) {
      const passwordInput = document.getElementById(inputElementId);
      const toggleButton = document.getElementById(toggleButtonId);

      if (passwordInput && toggleButton) {
        toggleButton.addEventListener('click', () => {
          const isPassword = passwordInput.getAttribute('type') === 'password';
          const newType = isPassword ? 'text' : 'password';
          passwordInput.setAttribute('type', newType);

          const iconSpan = toggleButton.querySelector('.material-symbols-outlined');
          if (iconSpan) {
            iconSpan.textContent = isPassword ? 'visibility' : 'visibility_off';
          }
        });
      }
    }

    setupPasswordToggle('{{ form.password1.id_for_label }}', 'toggle-password-1');
    setupPasswordToggle('{{ form.password2.id_for_label }}', 'toggle-password-2');
  });
</script>
{% endblock extra_js %}